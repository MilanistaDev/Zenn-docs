---
title: "ä½ã¿ãŸã„è¡—ãƒ©ãƒ³ã‚­ãƒ³ã‚°2021å¹´ç‰ˆãŒç™ºè¡¨ã•ã‚ŒãŸã®ã§SwiftUIã§ãƒˆãƒ¬ãƒ¼ã‚¹ã—ã¦ã¿ãŸ!!"
emoji: "ğŸ‘‹"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["iOS", "SwiftUI", "Swift"]
published: false
---

## ã¯ã˜ã‚ã«

ä»Šå›ãŒ Zenn åˆè¨˜äº‹ã«ãªã‚Šã¾ã™ã€‚
Qiita ã§è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ã¾ã—ãŸãŒæ°—åˆ†è»¢æ›ã«
ã‚„ã£ã¦ã¿ãŸç³»ã¯ã“ã¡ã‚‰ã«æŠ•ç¨¿ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

ã‚¢ãƒ—ãƒªã«ã—ã‚„ã™ãã†ãªãƒã‚¿ã‚’é¡Œæã«ã—ã¦
ã“ã†ã„ã†å®Ÿè£…ã©ã†ã‚„ã‚‹ã‚“ã ã‚ã†ï¼Ÿã¨ã‹ã‚ã®æ©Ÿèƒ½ä½¿ã£ã¦ã¿ãŸã„ãªãƒ¼
çš„ãªå†…å®¹ã‚’å®Ÿéš›ã«å®Ÿè£…ã—ã¦ã¿ã¦æ›¸ãæ®‹ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚
åŸºæœ¬ SwiftUI ã§ã¨è€ƒãˆã¦ã„ã¦ UIKit ã¨æ¯”è¼ƒã™ã‚‹å½¢ã‚‚å–ã‚Œã‚Œã°ã¨æ€ã„ã¾ã™ã€‚
ã¾ã å€‹äººé–‹ç™ºãƒ¬ãƒ™ãƒ«ã§ã¯å®Ÿç¾ã§ãã‚‹ã‹ã«é‡ãã‚’ãŠã“ã†ã¨æ€ã£ã¦ã‚‹ã®ã§
è¨­è¨ˆã‚„æ›¸ãæ–¹ã¯ã‚ã¾ã‚Šç¶ºéº—ã«ã¨ã¯è€ƒãˆã¦ãŠã‚Šã¾ã›ã‚“ã€‚
ã“ã†ã—ãŸæ–¹ãŒè‰¯ã•ãã†ãªã©ã¯æŒ‡æ‘˜ã„ãŸã ãã¨å¬‰ã—ã„ã§ã™ã€‚

## ä»Šå›å®Ÿè£…ã™ã‚‹ã‚‚ã®

LIFULL HOMEâ€™S ãŒæ¯å¹´ç®—å‡ºã—ã¦ã„ã‚‹ä½ã¿ãŸã„è¡—ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’é¡Œæã«ã—ã¾ã™ã€‚
å…ˆæ—¥ï¼Œ2021 å¹´ç‰ˆãŒå‡ºãŸã®ã§ãã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦ã¿ã¾ã™ã€‚
ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã¯ç§ãŒã‚µã‚¤ãƒˆã‚’ã¿ã¦ JSON æ–¹å¼ã«ã—ã¾ã—ãŸã€‚

å€Ÿã‚Šã¦ä½ã¿ãŸã„ï¼Œè²·ã£ã¦ä½ã¿ãŸã„ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãŒãã‚Œãã‚Œã‚ã‚Šï¼Œ
ä»Šå›ã¯é¦–éƒ½åœã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°å„20ä½ã¾ã§ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
ã¾ãŸã‚µã‚¤ãƒˆã«ã‚ã‚‹ã‚ˆã†ã« 11ä½ä»¥é™ã¯å‡ºã—åˆ†ã‘ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
å·¦å³ã«ã‚¹ãƒ¯ã‚¤ãƒ—ï¼Œã¾ãŸã¯ã‚¿ãƒ–éƒ¨åˆ†ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã“ã¨ã§
å€Ÿã£ã¦ä½ã¿ãŸã„ã¨è²·ã£ã¦ä½ã¿ãŸã„ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ç§ã¯ã‚µã‚¯ãƒƒã¨ Google App Script ã§ JSON ã‚’è¿”ã™ã‚ˆã†ã«å¤–éƒ¨ API ã‚’ä½œã‚Šã¾ã—ãŸãŒ
GitHub ã®ã‚µãƒ³ãƒ—ãƒ«ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã® JSON ã‚’èª­ã¿è¾¼ã‚€ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

å®Œæˆã—ãŸã‚‚ã®ã¯ã“ã¡ã‚‰ã§ã™ã€‚

GIF

## é–‹ç™ºç’°å¢ƒ

é–‹ç™ºç’°å¢ƒã¯ä¸‹è¨˜ã§ã™ã€‚

* iOS 14.0 and later
* Xcode 12.4
* macOS Big Sur 11.2

GitHub ã«ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’ç”¨æ„ã—ãŸã®ã§å¿…è¦ã«å¿œã˜ã¦å‚ç…§ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
https://github.com/MilanistaDev/TownRanking2021

### å‚è€ƒã«ã—ãŸã‚µã‚¤ãƒˆ

ä»Šå›ã®ã‚¢ãƒ—ãƒªã®é¡Œæã¨ã—ã¦ï¼ŒLIFULL HOME'S ã®ä½ã¿ãŸã„è¡—ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚
ã‚³ãƒ­ãƒŠç¦ãªã“ã¨ã‚‚ã‚ã‚‹ã®ã‹å¤§ããé †ä½ã‚’ä¸Šã’ãŸè¡—ã‚‚å¤šãèˆˆå‘³æ·±ã‹ã£ãŸã§ã™ã€‚
é¦–éƒ½åœã ã‘å‚ç…§ã—ã¾ã—ãŸãŒï¼Œä»–ã®åœ°åŸŸã‚‚åŠ ãˆã‚Œã°ã‚‚ã£ã¨é¢ç™½ããªã‚Šãã†ã§ã™ã€‚

https://www.homes.co.jp/cont/s_ranking/shutoken/

ä½¿ã†ãƒ‡ãƒ¼ã‚¿ã® JSON ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã“ã¡ã‚‰ã§ã™ã€‚
`isRankUp` ã¯ãƒ©ãƒ³ã‚¯ã‚¢ãƒƒãƒ—ã—ãŸã‹ã©ã†ã‹ï¼Œ`rankFluctuation` ã¯å¤‰åŒ–é‡ã§ã™ã€‚
(ä»Šæ€ã†ã¨ãƒ©ãƒ³ã‚¯å¤‰åŒ–é‡ã ã‘ã§ãƒ©ãƒ³ã‚¯ã‚¢ãƒƒãƒ—/ãƒ€ã‚¦ãƒ³/ã‚­ãƒ¼ãƒ—åˆ¤æ–­ã—ãŸã»ã†ãŒã‚ˆã‹ã£ãŸğŸ¤”)

:::details ä½¿ã†ãƒ‡ãƒ¼ã‚¿ã® JSON ãƒ•ã‚¡ã‚¤ãƒ«
```json:TownRanking2021.json
{
    "townRankingsForRent": [
        {
            "rank": 1,
            "townName": "æœ¬åšæœ¨",
            "isRankUp": true,
            "rankFluctuation": 3,
            "availableLine": "å°ç”°æ€¥å°ç”°åŸç·š"
        },
        {
            "rank": 2,
            "townName": "å¤§å®®",
            "isRankUp": true,
            "rankFluctuation": 3,
            "availableLine": "JRäº¬æµœæ±åŒ—ãƒ»æ ¹å²¸ç·šã»ã‹"
        },
        {
            "rank": 3,
            "townName": "è‘›è¥¿",
            "isRankUp": false,
            "rankFluctuation": 1,
            "availableLine": "æ±äº¬ãƒ¡ãƒˆãƒ­æ±è¥¿ç·š"
        },
        {
            "rank": 4,
            "townName": "å…«ç‹å­",
            "isRankUp": true,
            "rankFluctuation": 3,
            "availableLine": "JRä¸­å¤®ç·šã»ã‹"
        },
        {
            "rank": 5,
            "townName": "æ± è¢‹",
            "isRankUp": false,
            "rankFluctuation": 4,
            "availableLine": "JRå±±æ‰‹ç·šã»ã‹"
        },
        {
            "rank": 6,
            "townName": "åƒè‘‰",
            "isRankUp": true,
            "rankFluctuation": 8,
            "availableLine": "JRç·æ­¦ç·šã»ã‹"
        },
        {
            "rank": 7,
            "townName": "è•¨",
            "isRankUp": true,
            "rankFluctuation": 4,
            "availableLine": "JRäº¬æµœæ±åŒ—ãƒ»æ ¹å²¸ç·š"
        },
        {
            "rank": 8,
            "townName": "ä¸‰é·¹",
            "isRankUp": true,
            "rankFluctuation": 9,
            "availableLine": "JRä¸­å¤®ç·šã»ã‹"
        },
        {
            "rank": 9,
            "townName": "æŸ",
            "isRankUp": true,
            "rankFluctuation": 7,
            "availableLine": "JRå¸¸ç£ç·šã»ã‹"
        },
        {
            "rank": 10,
            "townName": "å·å´",
            "isRankUp": false,
            "rankFluctuation": 7,
            "availableLine": "JRæ±æµ·é“æœ¬ç·šã»ã‹"
        },
        {
            "rank": 11,
            "townName": "é«˜å††å¯º",
            "isRankUp": true,
            "rankFluctuation": 2,
            "availableLine": "JRä¸­å¤®ç·šã»ã‹"
        },
        {
            "rank": 12,
            "townName": "è¥¿å·å£",
            "isRankUp": true,
            "rankFluctuation": 8,
            "availableLine": "JRäº¬æµœæ±åŒ—ãƒ»æ ¹å²¸ç·š"
        },
        {
            "rank": 13,
            "townName": "èˆ¹æ©‹",
            "isRankUp": true,
            "rankFluctuation": 8,
            "availableLine": "JRç·æ­¦ç·šã»ã‹"
        },
        {
            "rank": 14,
            "townName": "ç”ºç”°",
            "isRankUp": true,
            "rankFluctuation": 8,
            "availableLine": "å°ç”°æ€¥å°ç”°åŸç·šã»ã‹"
        },
        {
            "rank": 15,
            "townName": "è»çªª",
            "isRankUp": false,
            "rankFluctuation": 7,
            "availableLine": "JRä¸­å¤®ç·šã»ã‹"
        },
        {
            "rank": 16,
            "townName": "ä¸‰è»’èŒ¶å±‹",
            "isRankUp": false,
            "rankFluctuation": 10,
            "availableLine": "æ±æ€¥ç”°åœ’éƒ½å¸‚ç·šã»ã‹"
        },
        {
            "rank": 17,
            "townName": "å·å£",
            "isRankUp": true,
            "rankFluctuation": 15,
            "availableLine": "JRä¸­å¤®ç·šã»ã‹"
        },
        {
            "rank": 18,
            "townName": "å‰ç¥¥å¯º",
            "isRankUp": false,
            "rankFluctuation": 9,
            "availableLine": "JRä¸­å¤®ç·šã»ã‹"
        },
        {
            "rank": 19,
            "townName": "æ–°å°å²©",
            "isRankUp": false,
            "rankFluctuation": 1,
            "availableLine": "JRç·æ­¦ç·šã»ã‹"
        },
        {
            "rank": 20,
            "townName": "å°å²©",
            "isRankUp": false,
            "rankFluctuation": 0,
            "availableLine": "JRç·æ­¦ç·š"
        }
    ],
    "townRankingsForBuy": [
        {
            "rank": 1,
            "townName": "å‹ã©ã",
            "isRankUp": false,
            "rankFluctuation": 0,
            "availableLine": "éƒ½å–¶å¤§æ±Ÿæˆ¸ç·š"
        },
        {
            "rank": 2,
            "townName": "ç™½é‡‘é«˜è¼ª",
            "isRankUp": true,
            "rankFluctuation": 17,
            "availableLine": "æ±äº¬ãƒ¡ãƒˆãƒ­å—åŒ—ç·šã»ã‹"
        },
        {
            "rank": 3,
            "townName": "æœ¬åšæœ¨",
            "isRankUp": true,
            "rankFluctuation": 8,
            "availableLine": "å°ç”°æ€¥å°ç”°åŸç·š"
        },
        {
            "rank": 4,
            "townName": "ä¸‰é·¹",
            "isRankUp": false,
            "rankFluctuation": 1,
            "availableLine": "JRä¸­å¤®ç·šã»ã‹"
        },
        {
            "rank": 5,
            "townName": "åŒ—æµ¦å’Œ",
            "isRankUp": false,
            "rankFluctuation": 1,
            "availableLine": "JRäº¬æµœæ±åŒ—ãƒ»æ ¹å²¸ç·š"
        },
        {
            "rank": 6,
            "townName": "å…«ç‹å­",
            "isRankUp": false,
            "rankFluctuation": 0,
            "availableLine": "JRä¸­å¤®ç·šã»ã‹"
        },
        {
            "rank": 7,
            "townName": "æŸ",
            "isRankUp": true,
            "rankFluctuation": 8,
            "availableLine": "JRå¸¸ç£ç·šã»ã‹"
        },
        {
            "rank": 8,
            "townName": "ç›®é»’",
            "isRankUp": true,
            "rankFluctuation": 13,
            "availableLine": "JRå±±æ‰‹ç·šã»ã‹"
        },
        {
            "rank": 9,
            "townName": "æµæ¯”å¯¿",
            "isRankUp": false,
            "rankFluctuation": 7,
            "availableLine": "JRå±±æ‰‹ç·šã»ã‹"
        },
        {
            "rank": 10,
            "townName": "æ±äº¬",
            "isRankUp": false,
            "rankFluctuation": 5,
            "availableLine": "JRæ±æµ·é“æœ¬ç·šã»ã‹"
        },
        {
            "rank": 11,
            "townName": "æ©‹æœ¬",
            "isRankUp": true,
            "rankFluctuation": 31,
            "availableLine": "JRæ¨ªæµœç·šã»ã‹"
        },
        {
            "rank": 12,
            "townName": "æµ¦å’Œ",
            "isRankUp": false,
            "rankFluctuation": 5,
            "availableLine": "JRäº¬æµœæ±åŒ—ãƒ»æ ¹å²¸ç·šã»ã‹"
        },
        {
            "rank": 13,
            "townName": "åƒè‘‰",
            "isRankUp": true,
            "rankFluctuation": 49,
            "availableLine": "JRç·æ­¦ç·šã»ã‹"
        },
        {
            "rank": 14,
            "townName": "å¹³å¡š",
            "isRankUp": true,
            "rankFluctuation": 25,
            "availableLine": "JRæ±æµ·é“æœ¬ç·šã»ã‹"
        },
        {
            "rank": 15,
            "townName": "å¤§å®®",
            "isRankUp": true,
            "rankFluctuation": 9,
            "availableLine": "JRäº¬æµœæ±åŒ—ãƒ»æ ¹å²¸ç·šã»ã‹"
        },
        {
            "rank": 16,
            "townName": "æœéœ",
            "isRankUp": true,
            "rankFluctuation": 13,
            "availableLine": "æ±æ­¦æ±ä¸Šç·š"
        },
        {
            "rank": 17,
            "townName": "å…«è¡—",
            "isRankUp": true,
            "rankFluctuation": 9,
            "availableLine": "JRç·æ­¦æœ¬ç·š"
        },
        {
            "rank": 18,
            "townName": "å·å£",
            "isRankUp": true,
            "rankFluctuation": 9,
            "availableLine": "JRäº¬æµœæ±åŒ—ãƒ»æ ¹å²¸ç·š"
        },
        {
            "rank": 19,
            "townName": "ç‰›è¾¼æŸ³ç”º",
            "isRankUp": true,
            "rankFluctuation": 191,
            "availableLine": "éƒ½å–¶å¤§æ±Ÿæˆ¸ç·š"
        },
        {
            "rank": 20,
            "townName": "ä¸­ç›®é»’",
            "isRankUp": false,
            "rankFluctuation": 7,
            "availableLine": "æ±äº¬ãƒ¡ãƒˆãƒ­æ—¥æ¯”è°·ç·šã»ã‹"
        }
    ]
}
```
:::

## ä»Šå›æŠ‘ãˆãŸã„å†…å®¹

* `HStack`ï¼Œ`VStack`ï¼Œ`ZStack` ãªã©ã®åŸºæœ¬çš„ãªå†…å®¹ã®å¾©ç¿’
* `@State`ï¼Œ`@Binding` ãªã©ã®å€¤ã®æ‰±ã„ã®å¾©ç¿’
* `@ObservedObject`ï¼Œ`@Observable`ï¼Œ`@Published` ã‚’åˆ©ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿ã®æ‰±ã„ã®å¾©ç¿’
* iOS 14 ã§è¿½åŠ ã•ã‚ŒãŸ `TabView` ã® `PageTabViewStyle` ã‚’ä½¿ã£ã¦ã¿ã‚‹
* iOS 14 ã§è¿½åŠ ã•ã‚ŒãŸ `LazyVGrid` ã‚’ä½¿ã£ã¦ã¿ã‚‹
* ç°¡å˜ãª Animation ã®å¾©ç¿’
  - çŠ¶æ…‹ã®å¤‰åŒ–ã«å¯¾ã—ã¦ (`withAnimation`)
  - ãƒ“ãƒ¥ãƒ¼å†…ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å¯èƒ½ãªå¤‰æ›´ã«å¯¾ã—ã¦(`animation`)

## å®Ÿè£…

ç§ã¯ SwiftUI ã§ã‚¢ãƒ—ãƒªä½œã‚‹ã¨ãã¯è¦ªã‚¯ãƒ©ã‚¹ã® View ã«å®Ÿè£…ã—ã¦
å®Œæˆå¾Œã«åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã« View ã®å®Ÿè£…ã‚’åˆ‡ã‚Šå‡ºã™ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚
`@Binding` ä½¿ã†ã®ã‹ï¼ŒãŸã ã®å€¤æ¸¡ã—ã§è‰¯ã„ã®ã‹ãªã©ã®è€ƒæ…®ã‚’å¾Œã§è€ƒãˆãŸã„ã‹ã‚‰ã§ã™ã€‚
å®Ÿéš›ã®é–‹ç™ºã§ã¯è¨­è¨ˆãŒäº‹å‰ã«ã§ãã‚‹ã“ã¨ãŒå¤šã„ã®ã§ï¼Œ
æ¥­å‹™ã§ã¯ã„ããªã‚Šåˆ¥ã‚¯ãƒ©ã‚¹ã§ç›´æ¥æ›¸ãã“ã¨ã¯å¤šãã†ã§ã™ã€‚

ä»Šå›ã¯ UI ã®å®Ÿç¾ãŒä¸»ãªå†…å®¹ãªã®ã§ï¼Œéƒ¨åˆ†çš„ã«åˆ‡ã‚Šå‡ºã—ãŸå½¢ã§æ›¸ã„ã¦ã„ãã¾ã™ã€‚

* è¦ª View ã‚¯ãƒ©ã‚¹ã®ç”»é¢
* ä¸Šéƒ¨ã®çŠ¶æ…‹åˆ‡ã‚Šæ›¿ãˆã‚¿ãƒ–éƒ¨åˆ†
* è¡—ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆéƒ¨åˆ†(ãƒšãƒ¼ã‚¸ãƒ³ã‚°)
* è¡—ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆéƒ¨åˆ†(ãƒªã‚¹ãƒˆè¡¨ç¤º)
* è¡—ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆéƒ¨åˆ†(11ä½ä»¥é™ã®è¡¨ç¤º/éè¡¨ç¤ºå¯¾å¿œ)
* ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆç”¨ã®è¡—ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã®å®Ÿè£…
* JSON ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚¹ãƒˆã«è¡¨ç¤º

### ä¸Šéƒ¨ã®çŠ¶æ…‹åˆ‡ã‚Šæ›¿ãˆã‚¿ãƒ–éƒ¨åˆ†ã®å®Ÿè£…

ä»Šå›ã®è¦ª View ã¯æ–°è¦ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œã£ãŸéš›ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ï¼Œ
`ContentView.swift` ã¨ã—ã¾ã™ã€‚å„éƒ¨åˆ†ã‚’å®Ÿè£…ã—ã¦ã„ããŸã³ã«å°‘ã—ãšã¤å¤‰ã‚ã£ã¦ã„ãã¾ã™ã€‚

ä¸Šéƒ¨ã®çŠ¶æ…‹åˆ‡ã‚Šæ›¿ãˆã‚¿ãƒ–ã®å®Ÿè£…ã§ã™ãŒï¼Œ
å€Ÿã‚Šã‚‹ã¨è²·ã†ã®çŠ¶æ…‹ã¯ï¼Œé¸æŠæ™‚ã«ãƒœã‚¿ãƒ³ã®ãƒ•ã‚©ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ã‚’ã¤ã‘ã‚‹ã®ã¨ï¼Œ
ãƒœã‚¿ãƒ³ã®ä¸‹ã«ãƒãƒ¼ã‚’ç”¨æ„ã•ã›ã¦é¸æŠçŠ¶æ…‹ã§è¿½å¾“ã•ã›ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/recxsh7pk20oxg6ux5gkojh0tpn9)

![](https://storage.googleapis.com/zenn-user-upload/hca13alxbao2jfffimithodaedo6)

`HStack` ã¨ `VStack` ã‚’çµ„ã¿åˆã‚ã›ã¦ä½œã‚Šã¾ã™ã€‚
å€Ÿã‚Šã‚‹ã¨è²·ã†ã®çŠ¶æ…‹ã¯ `enum` ã§ç®¡ç†ã—ã¾ã™ãŒï¼Œ
çŠ¶æ…‹ã®å¤‰åŒ–ã«ã‚ˆã£ã¦ãƒœã‚¿ãƒ³ã¨ãƒãƒ¼ï¼Œãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆã‚’è¿½å¾“ã•ã›ã‚‹ãŸã‚ã« `@State` ã‚’ã¤ã‘ã¾ã™ã€‚

å°‘ã—è€ƒãˆãªã‘ã‚Œã°ãªã‚‰ãªã„ã®ãŒï¼Œãƒãƒ¼ã® Frame ã§ã™ã€‚
`GeometryReader` ã‚’ä½¿ã£ã¦ç”»é¢å¹…ã®åŠåˆ†ã‚’ç®—å‡ºã—ã¾ã™ã€‚
(`UIScreen.main.bounds.size` ã§ã‚‚ä»Šå›ã¯å¤§ä¸ˆå¤«ã§ã™ã€‚)
åº§æ¨™ã«ã¤ã„ã¦ã¯ `offset` ã‚’ä½¿ã£ã¦ï¼Œå€Ÿã‚Šã‚‹ï¼Œè²·ã†ã®çŠ¶æ…‹ã«ã‚ˆã£ã¦ãšã‚‰ã™ã“ã¨ã«ã—ã¾ã—ãŸã€‚

```swift:ContentView.swift
enum TabType: Int {
    case rent
    case buy
}

struct ContentView: View {
    @State private var selection: TabType = .rent

    var body: some View {
        GeometryReader { geometry in
            NavigationView {
                VStack(spacing: .zero) {
                    UpperTabView(selection: $selection, geometrySize: geometry.size)
                    Spacer()
                }
                .navigationBarTitle("ä½ã¿ãŸã„è¡—ãƒ©ãƒ³ã‚­ãƒ³ã‚°2021(é¦–éƒ½åœ)",
                                    displayMode: .inline)
            }
        }
    }
}
```

`geometrySize` ã‚’ `CGSize` ã¨ã—ã¦ã‚’å€¤æ¸¡ã—ã—ã¦ã„ã¾ã™ã€‚
ãƒœã‚¿ãƒ³ã¨ãƒãƒ¼ã®å¹…ï¼Œãƒãƒ¼ã®åº§æ¨™è¨­å®šã«åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚
3é …æ¼”ç®—å­ã‚’ä½¿ã£ã¦ï¼Œå€Ÿã‚Šã‚‹ã¨è²·ã†ã®å„çŠ¶æ…‹ã®è‰²ã®è¨­å®šï¼Œãƒãƒ¼ã®åº§æ¨™è¨ˆç®—ãªã©ã‚‚è¡Œã£ã¦ã„ã¾ã™ã€‚
ã“ã®ã‚¿ãƒ–ã§ã®ãƒœã‚¿ãƒ³æ“ä½œã«ã‚ˆã£ã¦å¤‰ã‚ã‚‹çŠ¶æ…‹ã‚’è¦ª View ã«ä¼ãˆã‚‹å¿…è¦ãŒ
ä»Šå¾Œå‡ºã¦ãã‚‹ãŸã‚ï¼Œã“ã“ã§ `@Binding` ã‚’ã¤ã‘ã¦ãŠãã¾ã™ã€‚

```swift:UpperTabView.swift
struct UpperTabView: View {
    // ãƒœã‚¿ãƒ³ã®ã‚¿ãƒƒãƒ—ã§çŠ¶æ…‹ã‚’å¤‰ãˆã‚‹ è¦ªViewçŠ¶æ…‹ã‚’ä¼ãˆã‚‹ãŸã‚ @Binding ã‚’ã¤ã‘ã¦ãŠã
    @Binding var selection: TabType
    let geometrySize: CGSize

    var body: some View {
        VStack(alignment: .leading, spacing: .zero) {
            HStack(spacing: .zero) {
                Button(action: {
                    // å€Ÿã‚Šã¦ä½ã¿ãŸã„ãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—ã§å€Ÿã‚Šã‚‹çŠ¶æ…‹ã«å¤‰æ›´
                    self.selection = .rent
                }, label: {
                    Text("å€Ÿã‚Šã¦ä½ã¿ãŸã„")
                        .foregroundColor(self.selection == .rent ?
                                            .rentOrange: .gray)
                         .font(.headline)
                })
                .frame(width: geometrySize.width / 2, height: 44.0)
                Button(action: {
                    // è²·ã£ã¦ä½ã¿ãŸã„ãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—ã§è²·ã†çŠ¶æ…‹ã«å¤‰æ›´
                    self.selection = .buy
                }, label: {
                    Text("è²·ã£ã¦ä½ã¿ãŸã„")
                        .foregroundColor(self.selection == .rent ?
                                            .gray: .buyBlue)
                        .font(.headline)
                })
                .frame(width: geometrySize.width / 2, height: 44.0)
            }
            Rectangle()
                .fill(self.selection == .rent ? Color.rentOrange: Color.buyBlue)
                .frame(width: geometrySize.width / 2, height: 2.0)
                .offset(x: self.selection == .rent ? .zero: geometrySize.width / 2, y: .zero)
        }
    }
}
```

ã“ã“ã¾ã§ã®å®Ÿè£…ã§å®Ÿè¡Œã™ã‚‹ã¨ãã‚Œãã‚Œã®ãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—ã§ï¼Œ
å€Ÿã‚Šã‚‹ï¼Œè²·ã†ã®çŠ¶æ…‹ãŒå¤‰ã‚ã£ã¦ãƒœã‚¿ãƒ³ã®è‰²ã‚„ãƒãƒ¼ã‚‚è¿½å¾“ã—ã¦ãã‚Œã¾ã™ã€‚

ãƒãƒ¼ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã›ãŸã„ãªã¨æ€ã£ã¦èª¿ã¹ã¦ 2ç¨®é¡æ–¹æ³•è¦‹ã¤ã‘ãŸã®ã§ã™ãŒï¼Œ
ã“ã“ã§ã¯ã²ã¨ã¤ç›®ã®ã‚‚ã®ã‚’æ¡ç”¨ã—ã¾ã—ãŸã€‚è¦‹ã¤ã‘ãŸã¨ãã¡ã‚‡ã£ã¨æ„Ÿå‹•ã—ã¾ã—ãŸã€‚
`withAnimation`[^1] ã‚’ä½¿ã†ã“ã¨ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã›ãªãŒã‚‰
`Bool` å€¤ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚ŒãŸã‚Šã™ã‚‹ã‚“ã§ã™ã­ã€‚è‰²ã€…ä¾¿åˆ©ãã†ã€‚

ä»Šå›ã¯ï¼Œ`enum` ã®çŠ¶æ…‹ã‚’0.3 ç§’ã‹ã‘ã¦å¤‰æ›´ã•ã›ã¾ã—ãŸã€‚
ã“ã ã‚ã‚Šã¯ãªã‹ã£ãŸã®ã§ `linear`(ç­‰é€Ÿ)ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã›ã¦ã„ã¾ã™ã€‚


```diff swift
Button(action: {
-    self.isRent = true
+    withAnimation(.linear(duration: 0.3)) {
+        self.selection = .rent
+    }
}, label: {
    // ç•¥
})

Button(action: {
-    self.isRent = false
+    withAnimation(.linear(duration: 0.3)) {
+        self.selection = .buy
+    }
}, label: {
    // ç•¥
})
```
ã“ã‚Œã§çŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã¨ãƒãƒ¼ãŒè¿½å¾“ã—ã¦ãã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸğŸ‰
ã“ã®å®Ÿè£…ã‚’ã—ãŸã¨ãã¯æ„Ÿå‹•ãŒã‚ã‚Šã¾ã—ãŸãŒï¼Œæœ€çµ‚çš„ã«ã¯ãƒ»ãƒ»ãƒ»
åˆ¥ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…ã‚’é¸æŠã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã—ãŸãŒãã‚Œã¯å¾Œè¿°ã—ã¾ã™ã€‚

GIF

:::message
* `@State`ï¼Œ`@Binding` ã‚’åˆ©ç”¨ã—ãŸçŠ¶æ…‹åˆ‡ã‚Šæ›¿ãˆã®æ‰±ã„æ–¹
* ãƒãƒ¼ã®åº§æ¨™åˆ‡ã‚Šæ›¿ãˆã¯ `offset` ã§ãšã‚‰ã›ã°å®Ÿç¾ã§ãã‚‹ï¼
* `withAnimation` ã§ä»»æ„ã®æ™‚é–“ã‚’ã‹ã‘ã¦çŠ¶æ…‹ã‚’å¤‰åŒ–ã•ã›ã‚‹ã“ã¨ãŒã§ãã¦ä¾¿åˆ©ï¼
:::

### è¡—ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆéƒ¨åˆ†(ãƒšãƒ¼ã‚¸ãƒ³ã‚°)

å€Ÿã‚Šã¦ä½ã¿ãŸã„ï¼Œè²·ã£ã¦ä½ã¿ãŸã„ãƒ©ãƒ³ã‚­ãƒ³ã‚°éƒ¨åˆ†ã¯å·¦å³ã«ã‚¹ãƒ¯ã‚¤ãƒ—(ãƒšãƒ¼ã‚¸ãƒ³ã‚°)ã•ã›ã¦ã¿ã¾ã™ã€‚
ãã“ã§ä½¿ã£ã¦ã¿ãŸã‹ã£ãŸã®ãŒ iOS 14 ã‹ã‚‰ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ãŸ `TabView` ã®æ–°è¦ç´ ã§ã™ã€‚

`TabView` ã¯ SwiftUI åˆæœŸã‹ã‚‰ã‚ã‚Šã¾ã—ãŸã€‚
ç”¨é€”ã¯æ–‡å­—é€šã‚Š UIKit ã§ã® `UITabBarController` çš„ãªä½¿ã„æ–¹ã§ã™ã€‚
iOS 14 ã‹ã‚‰ `PageTabViewStyle` ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚
`UIPageViewController` çš„ãªãƒšãƒ¼ã‚¸ãƒ³ã‚°ãŒå¯èƒ½ãª UI ãŒå®Ÿç¾ã§ãã¾ã™ã€‚

ä½¿ã„æ–¹ã¯ï¼Œ`tabViewStyle` ã®è¨­å®šã‚’ `PageTabViewStyle` ã«ã™ã‚‹ã ã‘ã§ã™ã€‚
`TabView` ã®ä¸­ã§è¡¨ç¤ºã•ã›ãŸã„ `View` ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚
ãã†ã™ã‚‹ã¨ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã™ã‚‹ã¨ãã‚Œãã‚Œã® `View` ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

`indexDisplayMode` ã¯ `automatic`ï¼Œ`always`ï¼Œ`never` ã®3ç¨®é¡ãŒã‚ã‚Šã¾ã™ã€‚
ã“ã‚Œã¯ï¼ŒUIKit ã§ã® `UIPageControl`ï¼Œã¤ã¾ã‚Šç¾åœ¨ã® index ã‚’ç¤ºã™ UI ã§ã™ã€‚
ä»Šå›ã¯ä¸è¦ãªã®ã§ `never` ã‚’ä½¿ã„ã¾ã™ã€‚
ä¸‹è¨˜ã®ã‚ˆã†ã«ã¨ã¦ã‚‚æ¥½ã«æ›¸ã‘ã¾ã™ğŸ˜‚

```swift
TabView {
    Text("Page A")
    Text("Page B")
}
.tabViewStyle(PageTabViewStyle(indexDisplayMode: .never))
```

ä»Šå›ã¯ã“ã‚Œã«åŠ ãˆã¦ `selection` ã®æ¦‚å¿µã‚’ä½¿ã„ã¾ã™ã€‚
ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã«ã‚ˆã£ã¦è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ `View` ã® index ã‚’çŸ¥ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ãã®ãŸã‚ï¼Œ`View` ã«ã¯ãã‚Œãã‚Œ `tag` ã‚’ä»˜ä¸ã—ã¾ã™ã€‚
`tag` ã¯ `Hashable` ã«æº–æ‹ ã—ã¦ã„ã‚Œã°å¤§ä¸ˆå¤«ã§ä»Šå›ã¯ `enum` ã®çŠ¶æ…‹(`Int`å‹)ã‚’ä½¿ã„ã¾ã™ã€‚

`ContentPageView.swift` ã‚’æ–°è¦ã§ä½œã£ã¦ã“ã‚Œã‚’ãƒ©ãƒ³ã‚­ãƒ³ã‚°éƒ¨åˆ†ã«ã—ã¾ã™ã€‚
å€Ÿã£ã¦ä½ã¿ãŸã„ï¼Œè²·ã£ã¦ä½ã¿ãŸã„ã®å„çŠ¶æ…‹ã«ãã‚Œãã‚Œã® `View` ãŒã‚ã£ã¦
ãã® `View` ã‚’å·¦å³ã«ã‚¹ãƒ¯ã‚¤ãƒ—ã—ã¦ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã™ã‚‹ã“ã¨ã§å„çŠ¶æ…‹ã«å¯¾å¿œã—ãŸ `View` ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
ã¾ãŸï¼Œãã®éš›ä¸Šéƒ¨ã®ã‚¿ãƒ–ã®çŠ¶æ…‹ã‚‚åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚
ã“ã“ã§ `selection` ã®é€£æºãŒæ´»ãã¦ãã¾ã™ã€‚

```swift:ContentPageView.swift
struct ContentPageView: View {
    // ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã™ã‚‹ã“ã¨ã§çŠ¶æ…‹ãŒå¤‰ã‚ã‚‹ã®ã§ @Binding ã‚’ä½¿ã†
    @Binding var selection: TabType

    var body: some View {
        TabView(selection: $selection) {
            Text("Rent")
                .tag(TabType.rent)
            Text("Buy")
                .tag(TabType.buy)
        }
        .tabViewStyle(PageTabViewStyle(indexDisplayMode: .never))
    }
}
```
:::details ã“ã®æ™‚ç‚¹ã® ContentView.swift
```swift:ContentView.swift
enum TabType: Int {
    case rent
    case buy
}

struct ContentView: View {
    @State private var selection: TabType = .rent

    var body: some View {
        GeometryReader { geometry in
            NavigationView {
                VStack(spacing: .zero) {
                    UpperTabView(selection: $selection, geometrySize: geometry.size)
                    // ã“ã“è¿½åŠ  â†“
                    ContentPageView(selection: $selection)
                }
                .navigationBarTitle("ä½ã¿ãŸã„è¡—ãƒ©ãƒ³ã‚­ãƒ³ã‚°2021(é¦–éƒ½åœ)",
                                    displayMode: .inline)
            }
        }
    }
}
```
:::

å·¦å³ã«ã‚¹ãƒ¯ã‚¤ãƒ—ã—ã¦ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã™ã‚‹ã“ã¨ã§çŠ¶æ…‹ãŒå¤‰ã‚ã‚‹ã®ã§ `@Binding` ã‚’ä½¿ã£ã¦
è¦ª View(`ContentView`) ã«çŠ¶æ…‹ã®å¤‰åŒ–ã‚’ä¼ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚
ã“ã“ã§ã®ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã«ã‚ˆã‚‹çŠ¶æ…‹å¤‰åŒ–ã¯ï¼Œè¦ª View çµŒç”±ã§ã‚¿ãƒ–(`UpperTabView`)ã«ã‚‚ä¼ãˆã‚‰ã‚Œï¼Œã‚ˆã£ã¦ã‚¿ãƒ–ã®çŠ¶æ…‹åˆ‡ã‚Šæ›¿ãˆã‚‚è¡Œã‚ã‚Œã¾ã™ã€‚

ã“ã“ã¾ã§ã®å®Ÿè£…ã®å®Ÿè¡Œçµæœã¯ã“ã¡ã‚‰ã§ã™ã€‚

GIF

ä»•æ§˜çš„ã«ã¯å•é¡Œãªã„ã§ã™ãŒï¼Œã¡ã‚‡ã£ã¨æƒœã—ã„éƒ¨åˆ†ãŒã‚ã‚Šã¾ã™ã€‚
ä¸Šéƒ¨ã®ã‚¿ãƒ–ã®ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦çŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹éš›ã¯ï¼Œ
ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã‚‚ãƒãƒ¼ã‚‚è¿½å¾“ã—ã¦ãã‚Œã¾ã™ãŒï¼Œ
å·¦å³ã«ã‚¹ãƒ¯ã‚¤ãƒ—ã—ã¦ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã—ãŸå ´åˆã¯ä¸Šéƒ¨ã®ã‚¿ãƒ–ã®ãƒãƒ¼ãŒã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¾ã›ã‚“ã€‚

ç†ç”±ã¯ï¼Œãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—æ™‚ã«ã®ã¿ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã‚ˆã†ã«æ›¸ã„ã¦ã„ã‚‹ãŸã‚ã§ã™ã€‚
ã‚ˆã£ã¦çŠ¶æ…‹ã®å¤‰åŒ–ãŒã‚ã‚‹ãŸã³ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã›ã‚‹ãŸã‚ã«å®Ÿè£…ã‚’è¦‹ç›´ã—ã¾ã™ã€‚
`animation(_:)`[^2] ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ã‚’ä½¿ã„ã¾ã™ã€‚
ãƒ©ãƒƒãƒ—ã™ã‚‹ãƒ“ãƒ¥ãƒ¼å†…ã®ã™ã¹ã¦ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŒ–å¯èƒ½ãªå¤‰æ›´ã«é©ç”¨ã•ã‚Œã¾ã™ã€‚

`Button` ã® action ã§çŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã„ãŸã®ã‚’ã‚„ã‚ã¦ï¼Œ
ãƒãƒ¼ã® Viewï¼Œã™ãªã¯ã¡ `Rectangle` ã«ãƒ©ãƒƒãƒ—ã•ã›ã¾ã™ã€‚
ã“ã“ã§ã¯ï¼ŒçŠ¶æ…‹å¤‰åŒ–ã«ä¼´ã†ãƒãƒ¼ã®åº§æ¨™å¤‰æ›´ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒé©ç”¨ã•ã‚Œã¾ã™ã€‚

```diff swift:ContentPageView.swift
struct UpperTabView: View {

    @Binding var selection: TabType
    let geometrySize: CGSize

    var body: some View {
        VStack(alignment: .leading, spacing: .zero) {
            HStack(spacing: .zero) {
                // çœç•¥
            }
            Rectangle()
                .fill(self.selection == .rent ? Color.rentOrange: Color.buyBlue)
                .frame(width: geometrySize.width / 2, height: 2.0)
                .offset(x: self.selection == .rent ? .zero: geometrySize.width / 2, y: .zero)
+               .animation(.linear(duration: 0.3))
        }
    }
}
```

ã¾ãŸï¼Œ`ContentPageView` ã® `TabView` ã‚‚åŒæ§˜ã«ãƒ©ãƒƒãƒ—ã—ã¦ãŠãã¾ã™ã€‚
ä¸Šéƒ¨ã‚¿ãƒ–ã®ã‚¿ãƒƒãƒ—ã§çŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆãŸéš›ã«ï¼Œãƒšãƒ¼ã‚¸ãƒ³ã‚°ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã›ã‚‹ãŸã‚ã§ã™ã€‚

```diff swift:ContentPageView.swift
struct ContentPageView: View {

    @Binding var selection: TabType

    var body: some View {
        TabView(selection: $selection) {
            Text("Rent")
                .tag(TabType.rent)
            Text("Buy")
                .tag(TabType.buy)
        }
        .tabViewStyle(PageTabViewStyle(indexDisplayMode: .never))
+       .animation(.linear(duration: 0.3))
    }
}
```

ã“ã‚Œã§ï¼Œå€Ÿã‚Šã¦ä½ã¿ãŸã„ï¼Œè²·ã£ã¦ä½ã¿ãŸã„ãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—æ™‚ï¼Œ
å·¦å³ã«ã‚¹ãƒ¯ã‚¤ãƒ—ã—ã¦ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã—ãŸéš›ã«ã‚‚æœŸå¾…ã—ãŸå‹•ãã«ãªã‚Šã¾ã—ãŸã€‚

GIF


:::message
* `TabView` ã®æ–°ã—ã„ `PageTabViewStyle` ã®ä½¿ã„æ–¹ã‚’æŠ‘ãˆã‚‹
* `animation` ã¯ãƒ©ãƒƒãƒ—ã—ãŸ View ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŒ–å¯èƒ½ãªå¤‰æ›´ã«å¯¾ã—ã¦ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
:::

### è¡—ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆéƒ¨åˆ†(ãƒªã‚¹ãƒˆè¡¨ç¤º)

#### è¡—ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆéƒ¨åˆ†(LazyVGridéƒ¨åˆ†)

æ¬¡ã«å€Ÿã‚Šã¦ä½ã¿ãŸã„ï¼Œè²·ã£ã¦ä½ã¿ãŸã„ï¼Œ
ãã‚Œãã‚Œã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºç”¨ã®ãƒªã‚¹ãƒˆã‚’ä½œã‚Šã¾ã™ã€‚

`List` ã§ `TableView` ã¿ãŸã„ãªè¡¨ç¤ºã‚‚å¯èƒ½ã ã—ï¼Œ
`ForEach` ã‚’ä½¿ã£ã¦ View ã‚’ç¹°ã‚Šè¿”ã—è¡¨ç¤ºã™ã‚‹ã“ã¨ã§ã‚‚å®Ÿç¾å¯èƒ½ã§ã™ã€‚
ã›ã£ã‹ããªã®ã§ iOS 14 ã‹ã‚‰æ–°ã—ãä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ãŸ `LazyVGrid` ã‚’ä½¿ã£ã¦
ã‚«ãƒ¼ãƒ‰UI ã®ãƒªã‚¹ãƒˆã¿ãŸã„ã«ã—ã¦ã¿ã¾ã™ã€‚

`LazyVGrid`[^3] ã¯ UIKit ã§ã® `UICollectionView` ã«ã‚ãŸã‚Šã¾ã™ã€‚
SwiftUI åˆæœŸã«æ¬²ã—ã‹ã£ãŸã§ã™ã‚ˆã­ã€‚`LazyHGrid` ã‚‚ã‚ã‚Šã¾ã™ã€‚
Grid ã‚’çµ„ã‚“ã§ç¸¦ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã•ã›ã‚‹å ´åˆãŒ `LazyVGrid`ï¼Œ
Grid ã‚’çµ„ã‚“ã§æ¨ªã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã•ã›ã‚‹å ´åˆãŒ `LazyHGrid` ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚

> The grid is â€œlazy,â€ in that the grid view does not create items until they are needed.

å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ã‚‹é€šã‚Šï¼Œè¡¨ç¤ºã«å¿…è¦ã«ãªã‚‹ã¾ã§ Grid View(ã‚»ãƒ«)ã‚’ç”Ÿæˆã—ãªã„ã§ã™ã€‚
è¦ç´ æ•°ãŒå¤šã„å ´åˆã§ã‚‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚ˆããªã‚‹æ„Ÿã˜ã§ã™ã€‚
æ–°ã—ãç™»å ´ã—ãŸ `LazyVStack`ï¼Œ`LazyHStack` ã‚‚åŒã˜è€ƒãˆæ–¹ã§ã™ã€‚

`LazyVGrid` ã§ã¯æ¨ªã®ã‚»ãƒ«åŒå£«ã®ãƒãƒ¼ã‚¸ãƒ³ã®èª¿æ•´ã¯ï¼Œ`GridItem` ã§ï¼Œ
æ¬¡ã®åˆ—ã®ã‚»ãƒ«ã¨ã®ãƒãƒ¼ã‚¸ãƒ³ã¯ `LazyVGrid` ã®æ–¹ã§è¨­å®šã—ã¾ã™ã€‚
`LazyHGrid` ã¯é€†ã«ãªã‚Šã¾ã™ã€‚
`GridItem` ã§ã¯ã‚»ãƒ«ã®å¹…ã‚„è¡Œã”ã¨ã®ã‚»ãƒ«ã®æ•°ãªã©è¨­å®šã§ãã¾ã™ãŒï¼Œä»Šå›ã¯æœ€å°ã®å®Ÿè£…ã«ã—ã¾ã™ã€‚
æ¬¡å›ã‚ãŸã‚Šãƒ†ãƒ¼ãƒã«ã—ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚
ä»¥ä¸‹ï¼ŒGrid View ã¯ï¼Œã‚»ãƒ«ã¨ã—ã¦è¡¨ç¾ã—ã¾ã™ã€‚

`TownRankingListView.swift` ã‚’æ–°ãŸã«ç”Ÿæˆã—ï¼Œ
ã“ã¡ã‚‰ã«ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚
ã“ã® View ãŒãƒšãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚Œã‚‹ã‚ˆã†ã«æ›¸ãæ›ãˆã¾ã™ã€‚
ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆè‡ªä½“ã¯åŒã˜ã‚¯ãƒ©ã‚¹ã§ä½œã‚‹ã®ã§çŠ¶æ…‹ã‚’å¼•æ•°ã¨ã—ã¦æ¸¡ã—ã¾ã™ã€‚
ã¤ã„ã§ã« SafeArea ã‚‚ç„¡è¦–ã—ã¦ä¸€ç•ªä¸‹ã¾ã§è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã¾ã™ã€‚

```diff swift:ContentPageView.swift
struct ContentPageView: View {

    @Binding var selection: TabType

    var body: some View {
        TabView(selection: $selection) {
-           Text("Rent")
+           TownRankingListView(selection: selection)
                .tag(TabType.rent)
-           Text("Buy")
+           TownRankingListView(selection: selection)
                .tag(TabType.buy)
        }
        .tabViewStyle(PageTabViewStyle(indexDisplayMode: .never))
        .animation(.linear(duration: 0.3))
+       .edgesIgnoringSafeArea(.bottom)
    }
}
```

ä»Šå›ã®ä»•æ§˜ã¨ã—ã¦ã¯ï¼Œ1è¡Œã§10åˆ—ï¼Œãã‚Œãã‚Œã®ã‚»ãƒ«ã¨ã®ãƒãƒ¼ã‚¸ãƒ³ã¯ 10pt ã¨ã—ã¾ã™ã€‚
å·¦å³ã®ãƒãƒ¼ã‚¸ãƒ³ã¯ 16pt ãšã¤ã§ã™ãŒãƒãƒ¼ã‚¸ãƒ³ã®è¨­å®šã¯ï¼Œ
è¨³ã‚ã‚Šã§ `ForEach` ã§ View ç”Ÿæˆã®éš›ã«è¨­å®šã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ä¸€æ—¦ã‚»ãƒ«ã®ä»£ã‚ã‚Šã« `Rectangle` ã§ä»£ç”¨ã—ã¾ã™ã€‚
å€Ÿã‚Šã‚‹ã ã£ãŸã‚‰ã‚ªãƒ¬ãƒ³ã‚¸ï¼Œè²·ã†ã ã£ãŸã‚‰ãƒ–ãƒ«ãƒ¼ã§å¡—ã‚Šã¤ã¶ã—ã¾ã™ã€‚

ã‚»ãƒ«ã¨å·¦å³ä¸Šä¸‹ç«¯ã¨ã®ä½™ç™½ï¼Œ`UICollectionView` ã§ã„ã†ã¨ã“ã‚ã®
`UICollectionViewFlowLayout` ã® `sectionInset` ã¯ï¼Œ
`.padding(.all, 16.0)` ã§è¡¨ç¾ã§ãã¾ã™ã€‚æ·±ãè€ƒãˆãªãã¦ã„ã„ã®ã§æ¥½ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã­ã€‚

```swift:TownRankingListView.swift
struct TownRankingListView: View {

    // ã“ã®Viewã§å¤‰æ›´ã¯èµ·ããªã„ã®ã§å€¤æ¸¡ã—ã ã‘ã§è‰¯ã„
    let selection: TabType

    var body: some View {
        ScrollView {
            LazyVGrid(columns: [GridItem()], spacing: 0.0) {
                ForEach(0 ..< 10) { index in
                    Rectangle()
                        .fill(selection == .rent ? Color.rentOrange: Color.buyBlue)
                        .frame(height: 50)
                        .cornerRadius(8.0)
                        .padding(.bottom, 10.0)
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€// â†‘ä»Šå›ã¯æ“¬ä¼¼çš„ã« minimumLineSpacing ç›¸å½“ã¨ã™ã‚‹
                       // æœ¬æ¥ã¯ LazyVGrid ã® spacing ã§è¨­å®šã™ã‚‹
                }
            }
            .padding(.all, 16.0) // sectionInsetç›¸å½“
        }
        .background(Color.gridBackground)
    }
}
```

å®Ÿè¡Œã™ã‚‹ã¨ä¸‹è¨˜ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

GIF

#### è¡—ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆéƒ¨åˆ†(1~10ä½ã®ã‚»ãƒ«å®Ÿè£…)

ä»Šã¾ã§ã¯ `Rectangle` ã§ä»£ç”¨ã—ã¦ã„ã¾ã—ãŸãŒï¼Œ
ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã¨è¡—æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ã‚»ãƒ«ã‚’å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚
ã‚·ãƒ³ãƒ—ãƒ«ã‚¤ã‚ºãƒ™ã‚¹ãƒˆã¨ã„ã†ã“ã¨ã§ï¼Œã‚µã‚¤ãƒˆã¨åŒã˜ã‚ˆã†ãªãƒ‡ã‚¶ã‚¤ãƒ³ã«ã—ã¾ã™ã€‚
**ç§ãŒä»•æ§˜** ãªã®ã§ç”»åƒã¯ SFSymbols ã‹ã‚‰æ¢ã—ã¦ã‚¬ãƒ³ã‚¬ãƒ³ä½¿ã£ã¦ã¾ã™ã€‚

:::message
**ä»•æ§˜**
* 1ä½ã€œ3ä½ã¾ã§ã¯ç‹å† ä»˜ãã®ãƒ©ãƒ³ã‚¯è¡¨ç¤º
* è¡—åï¼Œãƒ©ãƒ³ã‚¯æƒ…å ±ï¼Œæœ€å¯„ã‚Šã®è·¯ç·šã‚’è¡¨ç¤ºã™ã‚‹
* ç”»åƒã¯ SFSymbols ã‹ã‚‰æ¢ã™
:::

`TownRowView` ã¨ã„ã†ã‚¯ãƒ©ã‚¹ã§ï¼Œ`HStack` ã¨ `VStack` ã‚’ä½¿ã£ã¦å®Ÿè£…ã—ã¾ã™ã€‚
ãŸã ï¼Œ1~3ä½ã®ç‹å† ã®ã‚µã‚¤ã‚ºã‚’å¤§ããã—ãŸã‚Šï¼Œé †ä½å¤‰å‹•éƒ¨åˆ†ã®å¹…ãŒå¯å¤‰ã ã£ãŸã‚Šã™ã‚‹ã“ã¨ã‚‚ã‚ã£ã¦ï¼Œ`ZStack` ã‚’ä½¿ã£ã¦é ˜åŸŸåˆ†ã®å¹…ã‚’å›ºå®šã§å–ã£ã¦ã„ã¾ã™ã€‚
ã¾ãŸï¼Œç¾æ™‚ç‚¹ã§ã¯ãã‚Œãã‚Œã®å€¤ã¯å›ºå®šå€¤ã¨ã—ã¦ã„ã¾ã™ã€‚
ä¸‰é …æ¼”ç®—å­ã°ã‹ã‚Šã§å°‘ã—å¯èª­æ€§æ‚ªã„ã‹ã‚‚ã§ã™ã­ğŸ¤”
â†“ è¤‡é›‘ãªå‰²ã«å¤§ã—ãŸã“ã¨ã¯ãªã„ã®ã§ãƒˆã‚°ãƒ«ã«ã—ã¾ã™ã€‚

:::details TownRowView ã®å®Ÿè£…

```swift:TownRowView.swift
import SwiftUI

struct TownRowView: View {
    let selection: TabType
    let rank: Int
    let isRankUp: Bool
    let rankFluctuation: Int

    var body: some View {
        HStack(spacing: 16.0) {
            ZStack {
                Rectangle()
                    .fill(Color.clear)
                    .frame(width: 50.0, height: 50.0)
                Image(systemName: rank < 4 ? "crown.fill": "circle.fill")
                    .resizable()
                    .scaledToFit()
                    .frame(width: rank < 4 ? 50.0: 30.0, height: rank < 4 ? 50.0: 30.0)
                    .offset(x: .zero, y: rank < 4 ? -5.0: .zero)
                    .foregroundColor(selection == .rent ? .rentOrange: .buyBlue)
                Text(rank.description)
                    .font(rank < 4 ? .title2: .subheadline)
                    .bold()
                    .foregroundColor(.white)
            }
            ZStack {
                Rectangle()
                    .fill(Color.clear)
                    .frame(width: 50.0, height: 50.0)
                VStack(spacing: 4.0) {
                    if !isRankUp && rankFluctuation == 0 {
                        Image(systemName: "minus.circle.fill")
                            .resizable()
                            .frame(width: 20.0, height: 20.0)
                            .foregroundColor(.gray)
                        Text("ã‚­ãƒ¼ãƒ—")
                            .font(.footnote)
                            .foregroundColor(.gray)
                    } else {
                        Image(systemName: isRankUp ? "arrow.up.circle.fill": "arrow.down.circle.fill")
                            .resizable()
                            .frame(width: 20.0, height: 20.0)
                            .foregroundColor(isRankUp ? .red: .blue)
                        Text(rankFluctuation.description + (isRankUp ? "ã‚¢ãƒƒãƒ—": "ãƒ€ã‚¦ãƒ³"))
                            .font(.footnote)
                            .foregroundColor(isRankUp ? .red: .blue)
                    }
                }
            }
            Text("æµ¦å®‰")
                .font(.body)
                .bold()
            Spacer()
            Text("æ±äº¬ãƒ¡ãƒˆãƒ­æ±è¥¿ç·š")
                .frame(width: 90.0)
                .lineLimit(nil)
                .foregroundColor(.gray)
                .font(.footnote)
        }
        .padding(.horizontal, 16.0)
        .padding(.vertical, 10.0)
        .background(Color.rowBackground)
        .cornerRadius(8.0)
        .shadow(color: Color.black.opacity(0.16), radius: 3.0, x: .zero, y: 3.0)
    }
}

struct TownRowView_Previews: PreviewProvider {
    static var previews: some View {
        TownRowView(selection: .rent, rank: 1, isRankUp: true, rankFluctuation: 10)
            .previewLayout(PreviewLayout.sizeThatFits)
            .padding()
        TownRowView(selection: .buy, rank: 4, isRankUp: false, rankFluctuation: 5)
            .previewLayout(PreviewLayout.sizeThatFits)
            .padding()
        TownRowView(selection: .rent, rank: 10, isRankUp: false, rankFluctuation: 0)
            .previewLayout(PreviewLayout.sizeThatFits)
            .padding()
    }
}
```
:::

ã“ã†ã„ã† View ã‚’ä½œã‚‹ã¨ãã¯ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒä¾¿åˆ©ã§ã™ã‚ˆã­ã€‚
çŠ¶æ…‹ã‚„å€¤ã‚’å¤‰ãˆã¦ä¸¦ã¹ã¦ã¿ã¾ã—ãŸã€‚
ã“ã® View ãŒãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆã®å„ã‚»ãƒ«ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/ntm6yjrj8uabg0wwohfijr3jxjn1 =600x)

`TownRankingListView` ã®ã‚»ãƒ«ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆéƒ¨åˆ†ã‚’æ›¸ãæ›ãˆã¾ã™ã€‚

```diff swift:TownRankingListView.swift
struct TownRankingListView: View {

    let selection: TabType

    var body: some View {
        ScrollView {
            LazyVGrid(columns: [GridItem()], spacing: 0.0) {
                ForEach(0 ..< 10) { index in
-                   Rectangle()
-                       .fill(selection == .rent ? Color.rentOrange: Color.buyBlue)
-                       .frame(height: 50)
-                       .cornerRadius(8.0)
+                   TownRowView(selection: selection, rank: 1, isRankUp: true, rankFluctuation: 10)
                        .padding(.bottom, 10.0)
                }
            }
            .padding(.all, 16.0)
        }
        .background(Color.gridBackground)
    }
}
```

å®Ÿè¡Œã™ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚Šã¾ã™ã€‚10å€‹ãã‚Œãã‚Œè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

|å€Ÿã‚Šã¦ä½ã¿ãŸã„|è²·ã£ã¦ä½ã¿ãŸã„|
|:--:|:--:|
|![](https://storage.googleapis.com/zenn-user-upload/3gmdl6sl9myvi2b2d4opdm3xkru2)|![](https://storage.googleapis.com/zenn-user-upload/vw9ppeqvnthuypyzu32cpkavbsdl)|

:::message
* `LazyVGrid` ã®ä½¿ã„æ–¹ã‚’æŠ‘ãˆã‚‹
:::

### è¡—ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆéƒ¨åˆ†(11ä½ä»¥é™ã®è¡¨ç¤º/éè¡¨ç¤ºå¯¾å¿œ)

å‚è€ƒã«ã—ãŸä½ã¿ãŸã„è¡—ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚µã‚¤ãƒˆã‚’è¦‹ã‚‹ã¨ï¼Œ
11ä½ä»¥é™ã¯ãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—ã§è¡¨ç¤ºãƒ»éè¡¨ç¤ºãŒåˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã®ã§ï¼Œ
åŒã˜ã‚ˆã†ã«ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ãƒãƒƒã‚¯ãªå®Ÿè£…ã«ã—ã¦ã¿ã¾ã™ã€‚

11ã€œ20ä½ã®ä»•æ§˜ã¯ä¸‹è¨˜ã®ã‚ˆã†ã«ã—ã¦ã¿ã¾ã—ãŸã€‚

:::message
**ä»•æ§˜**
* 11ã€œ20ä½ã¯ãƒœã‚¿ãƒ³ã®ã‚¿ãƒƒãƒ—ã§è¡¨ç¤ºãƒ»éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
* 11ã€œ20ä½ã¯ãƒãƒ¼ã‚¸ãƒ³ãªã—ã®ãƒªã‚¹ãƒˆè¡¨ç¤º
* è¡¨ç¤ºã¯ãƒ©ãƒ³ã‚¯ï¼Œãƒ©ãƒ³ã‚¯å¢—æ¸›ï¼Œè¡—åï¼Œæœ€å¯„ã‚Šè·¯ç·š
* ãƒ©ãƒ³ã‚¯éƒ¨åˆ†ã¯å…¨ã¦ä¸¸ã§èƒŒæ™¯è‰²ã¯è‰²ã¯å°‘ã—è–„ã‚ã®ã‚ªãƒ¬ãƒ³ã‚¸ãƒ»ãƒ–ãƒ«ãƒ¼ã«
* åˆ©ç”¨å¯èƒ½è·¯ç·šæƒ…å ±ã¯è¡—åã®ä¸‹ã«è¡¨ç¤º
:::

#### è¡—ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆéƒ¨åˆ†(11~20ä½ã®ã‚»ãƒ«å®Ÿè£…)

ã¾ãšã¯ï¼Œ11ã€œ20ä½ç”¨ã®ã‚»ãƒ«ã® View ã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã™ã€‚
1ã€œ10ä½ç”¨ã«å…ˆã»ã©å®Ÿè£…ã—ãŸ `TownRowView` ã‚’ä½¿ãŠã†ã¨æ€ã£ãŸã®ã§ã™ãŒï¼Œ
è¡¨ç¤ºã•ã›ã‚‹é …ç›®ã¯åŒã˜ã§ã¯ã‚ã‚‹ã®ã§ã™ãŒï¼Œä¸‰é …æ¼”ç®—å­ã‚‚å¤šãï¼Œ
ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚‚ç•°ãªã‚‹ãŸã‚ã•ã‚‰ã«è¤‡é›‘ã«ãªç†æƒ³ã ã£ãŸã®ã§æ–°è¦ã§ä½œã‚Šã¾ã™ã€‚
`SubTownRowView` ã¨ã—ã¾ã™ã€‚è§’ä¸¸è¨­å®šã‚‚ä¸è¦ã§ã™ã€‚

:::details 11ã€œ20ä½ã®ã‚»ãƒ«å®Ÿè£… SubTownRowView
```swift:
struct SubTownRowView: View {
    let selection: TabType
    let rank: Int
    let isRankUp: Bool
    let rankFluctuation: Int

    var body: some View {
        HStack(spacing: 16.0) {
            ZStack {
                Rectangle()
                    .fill(Color.clear)
                    .frame(width: 50.0, height: 50.0)
                Image(systemName: "circle.fill")
                    .resizable()
                    .scaledToFit()
                    .frame(width: 30.0, height: 30.0)
                    .foregroundColor(selection == .rent ? .subRentOrange: .subBuyBlue)
                Text(rank.description)
                    .font(.subheadline)
                    .bold()
                    .foregroundColor(.white)
            }
            ZStack {
                Rectangle()
                    .fill(Color.clear)
                    .frame(width: 50.0, height: 50.0)
                VStack(spacing: 4.0) {
                    if !isRankUp && rankFluctuation == 0 {
                        Image(systemName: "minus.circle.fill")
                            .resizable()
                            .frame(width: 20.0, height: 20.0)
                            .foregroundColor(.gray)
                        Text("ã‚­ãƒ¼ãƒ—")
                            .font(.footnote)
                            .foregroundColor(.gray)
                    } else {
                        Image(systemName: isRankUp ? "arrow.up.circle.fill": "arrow.down.circle.fill")
                            .resizable()
                            .frame(width: 20.0, height: 20.0)
                            .foregroundColor(isRankUp ? .red: .blue)
                        Text(rankFluctuation.description + (isRankUp ? "ã‚¢ãƒƒãƒ—": "ãƒ€ã‚¦ãƒ³"))
                            .font(.footnote)
                            .foregroundColor(isRankUp ? .red: .blue)
                    }
                }
            }
            VStack(alignment: .leading, spacing: 4.0) {
                Text("å¦™å…¸")
                    .font(.subheadline)
                    .bold()
                Text("æ±äº¬ãƒ¡ãƒˆãƒ­æ±è¥¿ç·š")
                    .lineLimit(nil)
                    .foregroundColor(.gray)
                    .font(.footnote)
            }
            Spacer()
        }
        .padding(.horizontal, 16.0)
        .padding(.vertical, 4.0)
        .background(Color.rowBackground)
    }
}

struct SubTownRowView_Previews: PreviewProvider {
    static var previews: some View {
        SubTownRowView(selection: .rent, rank: 11, isRankUp: true, rankFluctuation: 10)
            .previewLayout(PreviewLayout.sizeThatFits)
            .padding()
        SubTownRowView(selection: .buy, rank: 20, isRankUp: false, rankFluctuation: 5)
            .previewLayout(PreviewLayout.sizeThatFits)
            .padding()
        SubTownRowView(selection: .rent, rank: 20, isRankUp: false, rankFluctuation: 0)
            .previewLayout(PreviewLayout.sizeThatFits)
            .padding()
    }
}
```
:::

å…ˆã»ã©ã¨åŒã˜ã‚ˆã†ã«çŠ¶æ…‹ã‚„å€¤ã‚’å¤‰ãˆã¦ä¸¦ã¹ã¦ã¿ã¾ã—ãŸã€‚
ã“ã® View ãŒãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆ 11ã€œ20ä½ã®å„ã‚»ãƒ«ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/bjxb56giemoihsevnn8dbm9vek6f =600x)

#### è¡—ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆéƒ¨åˆ†(11~20ä½ã®ã‚»ãƒ«è¡¨ç¤º)

11ã€œ20ä½ã®ã‚»ãƒ«ã‚‚ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆã«è¡¨ç¤ºã•ã›ã¦ã¿ã¾ã™ã€‚
ãƒªã‚¹ãƒˆè¡¨ç¤ºã•ã›ãŸã„ã®ã§ï¼Œ`Section` ã§ãã‚Œãã‚Œç•°ãªã‚‹ãƒ–ãƒ­ãƒƒã‚¯ã«ã—ã¾ã™ã€‚
`Divider()` ã‚’ä½¿ã£ã¦ã‚»ãƒ«ã¨ã‚»ãƒ«ã¨ã®é–“ã«ãƒ©ã‚¤ãƒ³ã‚’å¼•ã„ã¦ãƒªã‚¹ãƒˆè¡¨ç¤ºã£ã½ãã—ã¦ã„ã¾ã™ã€‚
11ã€œ20ä½ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŸã‚ã«ï¼Œ`LazyVGrid` ã® `spacing` ã‚’ 0 ã«ã—ã¦ã„ãŸæ„Ÿã˜ã§ã™ã€‚
(`ForEach` ã®ç¯„å›²ã¯ 0ã€œ9 ã¾ã§ã«ãªã£ã¦ã„ã¾ã™ãŒ ã‚ã¨ã§ 11ã€œ20ä½ã®è¦ç´ ç”¨ã«å¤‰æ›´ã•ã‚Œã¾ã™ã€‚)

```diff swift:TownRankingListView.swift
struct TownRankingListView: View {

    let selection: TabType

    var body: some View {
        ScrollView {
            // 11ã€œ20ä½ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŸã‚ã«ã“ã®spacingã‚’0ã«ã—ã¦ã„ãŸ
            LazyVGrid(columns: [GridItem()], spacing: 0.0) {
+               Section {
                    ForEach(0 ..< 10) { index in
                        TownRowView(selection: selection, rank: 1, isRankUp: true, rankFluctuation: 10)
                            .padding(.bottom, 10.0)
                    }
+               }
+               Section {
+                   ForEach(0 ..< 10) { index in
+                       SubTownRowView(selection: selection, rank: 11, isRankUp: true, rankFluctuation: 30)
+                       Divider()
+                   }
+               }
            }
            .padding(.all, 16.0)
        }
        .background(Color.gridBackground)
    }
}
```

å®Ÿè¡Œã™ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚Šã¾ã™ã€‚ã•ã‚‰ã«ä¸‹ã« 10å€‹ãã‚Œãã‚Œè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
ã‚ã¨å°‘ã—ã€‚

|å€Ÿã‚Šã¦ä½ã¿ãŸã„|è²·ã£ã¦ä½ã¿ãŸã„|
|:--:|:--:|
|![](https://storage.googleapis.com/zenn-user-upload/jvgf33fjktdyj6x56f6pd2vxpuql)|![](https://storage.googleapis.com/zenn-user-upload/fcwe6r8aytn500ntqtafe4sw7r1n)|

#### è¡—ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆéƒ¨åˆ†(è¡¨ç¤ºãƒ»éè¡¨ç¤ºã®å®Ÿç¾)

æœ€å¾Œã«11ã€œ20ä½ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®è¡¨ç¤ºãƒ»éè¡¨ç¤ºã‚’å®Ÿç¾ã•ã›ã¦ã„ãã¾ã™ã€‚
11ã€œ20ä½ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®è¡¨ç¤ºï¼Œéè¡¨ç¤ºã¨ã„ã†çŠ¶æ…‹ã‚’è¡¨ç¾ã™ã‚‹ãŸã‚ã«
`isExpanded` ã¨ã„ã†å¤‰æ•°ã‚’å®šç¾©ã—ï¼Œ`isExpanded` ãŒ `true` ã®å ´åˆã®ã¿
11ã€œ20ä½ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆã‚’è¡¨ç¤ºã•ã›ã‚‹ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã™ã€‚

```diff swift:TownRankingListView.swift
struct TownRankingListView: View {

    let selection: TabType
+   @State private var isExpanded = false

    var body: some View {
        ScrollView {
            LazyVGrid(columns: [GridItem()], spacing: 0.0) {
                Section {
                    ForEach(0 ..< 10) { index in
                        TownRowView(selection: selection, rank: 1, isRankUp: true, rankFluctuation: 10)
                            .padding(.bottom, 10.0)
                    }
                }
+               if isExpanded {
                    Section {
                        ForEach(0 ..< 10) { index in
                            SubTownRowView(selection: selection, rank: 11, isRankUp: true, rankFluctuation: 30)
                            Divider()
                        }
                    }
                }
+           }
            .padding(.all, 16.0)
        }
        .background(Color.gridBackground)
    }
}
```

`isExpanded` ã®çŠ¶æ…‹åˆ‡ã‚Šæ›¿ãˆã¯ï¼Œ`Button` ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ä»»ã›ã¾ã™ã€‚
`ExpandButtonView` ã‚’æ–°è¦ã§å®Ÿè£…ã—ã¾ã™ã€‚
`isExpanded` ã®å€¤ã«ã‚ˆã£ã¦ãƒœã‚¿ãƒ³ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¤‰æ›´ã—ï¼Œã‚¢ãƒ­ãƒ¼ç”»åƒã®å‘ãã‚’å¤‰æ›´ã•ã›ã¾ã™ã€‚

:::details ExpandButtonView ã®å®Ÿè£…

```swift:ExpandButtonView.swift
struct ExpandButtonView: View {

    let selection: TabType
    // ã“ã®Viewã§ã®çŠ¶æ…‹å¤‰åŒ–ã‚’ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆã®Viewã«ä¼ãˆã‚‹
    @Binding var isExpanded: Bool

    var body: some View {
        Button {
            // ãƒœã‚¿ãƒ³ã®ã‚¿ãƒƒãƒ—ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§çŠ¶æ…‹ã‚’åˆ‡ã‚Šæ›¿ãˆ
            self.isExpanded.toggle()
        } label: {
            HStack {
                Text(isExpanded ? "é–‰ã˜ã‚‹": "11ä½ä»¥é™ã‚’è¦‹ã‚‹")
                    .font(.subheadline)
                    .bold()
                    .foregroundColor(.white)
                Image(systemName: isExpanded ? "chevron.up": "chevron.down")
                    .foregroundColor(.white)
            }
            .frame(height: 52.0)
            .frame(minWidth: .zero, maxWidth: .infinity)
            .background(selection == .rent ? Color.rentOrange: Color.buyBlue)
            .cornerRadius(8.0)
        }
    }
}

struct ExpandButtonView_Previews: PreviewProvider {
    static var previews: some View {
        Group {
            ExpandButtonView(selection: .rent, isExpanded: .constant(false))
                .previewLayout(PreviewLayout.sizeThatFits)
                .padding()
                .background(Color(.systemBackground))
            ExpandButtonView(selection: .rent, isExpanded: .constant(true))
                .previewLayout(PreviewLayout.sizeThatFits)
                .padding()
                .background(Color(.systemBackground))
        }
    }
}
```
:::

`isExpanded` ã®å€¤ã«ã‚ˆã£ã¦ä¸‹è¨˜ã®ã‚ˆã†ãªãƒ“ãƒ¥ãƒ¼ã®é•ã„ã«ãªã‚Šã¾ã™ã€‚
ã¾ãŸï¼Œ`selection` ã®å€¤ã«ã‚ˆã£ã¦èƒŒæ™¯è‰²ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/7yisxv8b0vv0lxweh3zi5ehsrv44 =600x)

æœ€å¾Œã«ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆã®ä¸€ç•ªä¸‹ã«ã“ã®ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«å®Ÿè£…è¿½åŠ ã—ã¾ã™ã€‚
ä¸€ç•ªä¸‹ã® SafeArea ã®é«˜ã•åˆ†ãƒœã‚¿ãƒ³ã®ä¸‹ã«è¿½åŠ ã—ã¦ã‚„ã‚‹ã¨è¦‹æ „ãˆãŒè‰¯ããªã‚Šã¾ã™ã€‚
SafeArea ã®é«˜ã•ã®å–å¾—æ–¹æ³•ã¯ä½•ç¨®é¡ã‹ã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒï¼Œ
`ContentView` ã§ `geometry.safeAreaInsets.bottom` ã§å–ã‚Œã‚‹ã®ã§å€¤æ¸¡ã—ã§æŒã£ã¦ãã¾ã—ãŸã€‚

```diff swift:TownRankingListView.swift
struct TownRankingListView: View {

    let selection: TabType
+   let safeAreaBottomHeight: CGFloat
    @State private var isExpanded = false

    var body: some View {
        ScrollView {
            LazyVGrid(columns: [GridItem()], spacing: 0.0) {
                Section {
                    ForEach(0 ..< 10) { index in
                        TownRowView(selection: selection, rank: 1, isRankUp: true, rankFluctuation: 10)
                            .padding(.bottom, 10.0)
                    }
                }
                if isExpanded {
                    Section {
                        ForEach(0 ..< 10) { index in
                            SubTownRowView(selection: selection, rank: 11, isRankUp: true, rankFluctuation: 30)
                            Divider()
                        }
                    }
                }
            }
            .padding(.all, 16.0)
+           ExpandButtonView(selection: selection, isExpanded: $isExpanded)
+               .padding(.horizontal, 16.0)
+               .padding(.bottom, 16.0 + safeAreaBottomHeight)
        }
        .background(Color.gridBackground)
    }
}
```

å®Ÿè¡Œã—ã¦ã¿ã‚‹ã¨å‹•ãã¯å®Ÿç¾ã§ãã¦ã„ã¾ã™ã€‚
ã‚ã¨ã¯ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦è¡¨ç¤ºã•ã›ã‚‹ã ã‘ã§ã™ã€‚

GIF

### ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆç”¨ã®è¡—ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ã®å®Ÿè£…

ä½ã¿ãŸã„è¡—ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç”¨ã® JSON ã‚’å…ƒã«ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†ãƒ¢ãƒ‡ãƒ«ã‚’å®Ÿè£…ã—ã¾ã™ã€‚
è¤‡é›‘ã§ã¯ãªã„ã§ã™ã€‚ä»Šå›ã¯ `Encodable` ã®æ–¹ã¯ã„ã‚‰ãªã„ã§ã™ã€‚

```swift:
struct TownRankingData: Decodable {
    var townRankingsForRent: [TownInfo]
    var townRankingsForBuy: [TownInfo]
}

struct TownInfo: Decodable {
    var rank: Int
    var townName: String
    var isRankUp: Bool
    var rankFluctuation: Int
    var availableLine: String
}
```

### JSON ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚¹ãƒˆã«è¡¨ç¤º

å…ˆè¿°ã—ãŸã¨ãŠã‚Šä»Šå›ã®è¨˜äº‹ã§ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã® JSON ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ã€‚
`TownRankingFetcher` ã‚¯ãƒ©ã‚¹ã‚’ä½œã£ã¦ï¼Œå–å¾—çµæœã‚’ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã•ã›ã¾ã™ã€‚

```swift:TownRankingFetcher.swift
class TownRankingFetcher {
    func fetchTownRanking(completion: @escaping (Result<TownRankingData, Error>) -> Void) {
        guard let path = Bundle.main.path(forResource: "TownRanking2021", ofType: "json") else { return }
        do {
            let data = try Data(contentsOf: URL(fileURLWithPath: path))
            let fetchedData = try JSONDecoder().decode(TownRankingData.self, from: data)
            DispatchQueue.main.async {
                completion(.success(fetchedData))
            }
        } catch  {
            DispatchQueue.main.async {
                completion(.failure(error))
            }
        }
    }
}
```

:::details APIã®ãƒªãƒ³ã‚¯ç”¨æ„ã—ã¦ URLSession ãªã©ä½¿ã£ã¦é€šä¿¡ã™ã‚‹å ´åˆ
```swift:TownRankingFetcher.swift
class TownRankingFetcher {
    func fetchTownRanking(completion: @escaping (Result<TownRankingData, Error>) -> Void) {
        URLSession.shared.dataTask(with: URL(string: APIã®ãƒªãƒ³ã‚¯)!) { (data, response, error) in
            guard let data = data else { return }
            let decoder: JSONDecoder = JSONDecoder()
            do {
                let fetchedData = try decoder.decode(TownRankingData.self, from: data)
                DispatchQueue.main.async {
                    completion(.success(fetchedData))
                }
            } catch {
                DispatchQueue.main.async {
                    completion(.failure(error))
                }
            }
        }.resume()
    }
}
```
:::

å¤–éƒ¨API ã‚’å©ã„ã¦ãƒªã‚¹ãƒˆè¡¨ç¤ºã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…ã¯
Qiita ã«ä»¥å‰æ›¸ã„ãŸã®ã§ã‚ˆã‹ã£ãŸã‚‰ã”è¦§ãã ã•ã„ğŸ™‡â€â™‚ï¸
https://qiita.com/MilanistaDev/items/64dca8c9d5099a19529e

æ¬¡ã« ViewModel ã‚’å®Ÿè£…ã—ã¾ã™ã€‚
`ObservableObject` ã«æº–æ‹ ã•ã›ã¦ï¼Œå¤‰æ›´ãŒã‚ã£ãŸéš›ã«é€šçŸ¥å¯èƒ½ã«ã—ã¾ã™ã€‚
ãƒ‡ãƒ¼ã‚¿ã®ãƒ¢ãƒ‡ãƒ«ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã« `@Published` å±æ€§ã‚’ä»˜åŠ ã—ã¦ç›£è¦–å¯¾è±¡ã¨ã—ã¾ã™ã€‚
`townRankingData` ã®åˆæœŸåŒ–ã¨ã—ã¦å€Ÿã‚Šã¦ä½ã¿ãŸã„ï¼Œè²·ã£ã¦ä½ã¿ãŸã„ï¼Œ
ãã‚Œãã‚Œã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã®é…åˆ—ã‚’ç©ºã«ã—ã¦ãŠã„ã¦ JSON ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—å¾Œã«
å¤‰æ›´ã‚’é€šçŸ¥ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹æ„Ÿã˜ã§ã™(ç°¡å˜ã«ã„ã†ã¨)ã€‚

```swift:TownRankingViewModel.swift
class TownRankingViewModel: ObservableObject {
    @Published var townRankingData =  TownRankingData(townRankingsForRent: [], townRankingsForBuy: [])

    let fetcher = TownRankingFetcher()

    init() {
        fetcher.fetchTownRanking { result in
            switch result {
            case .success(let townRankingData):
                // å–å¾—ã—ãŸãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’ä»£å…¥ã—ã¦å¤‰æ›´ã‚’ã“ã®ã‚¯ãƒ©ã‚¹ã‚’ç›£è¦–ã—ã¦ã„ã‚‹Viewã«é€šçŸ¥
                self.townRankingData = townRankingData
            case .failure(let error):
                debugPrint(error.localizedDescription)
            }
        }
    }
}
```

ãƒ‡ãƒ¼ã‚¿ã®å¤‰åŒ–ã‚’å—ã‘å–ã£ã¦ View ã‚’æ›´æ–°ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã™ã€‚
ä»Šå›ã®è¦ª View ã® `ContentView` ã§ ViewModel ã‚’å®šç¾©ã—ã¦ï¼Œ
`@ObservedObject` å±æ€§ã‚’ä»˜ä¸ã—ã¾ã™ã€‚
ã“ã‚Œã§ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿å–å¾—æ™‚ã«å¤‰æ›´ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
`TownRankingViewModel` ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ« `townRankingData` ã‚’
å­ã® View ã«æ¸¡ã—ã¦ã„ãã¾ã™ã€‚

```diff swift:ContentView.swift
struct ContentView: View {
    @State private var selection: TabType = .rent
+   @ObservedObject private var townRankingVM = TownRankingViewModel()

    var body: some View {
        GeometryReader { geometry in
            NavigationView {
                VStack(spacing: .zero) {
                    UpperTabView(selection: $selection,
                                 geometrySize: geometry.size)
                    ContentPageView(selection: $selection,
+                                   townRankingData: townRankingVM.townRankingData,                                 
                                    safeAreaBottomHeight: geometry.safeAreaInsets.bottom)
                }
                .edgesIgnoringSafeArea(.bottom)
                .navigationBarTitle("ä½ã¿ãŸã„è¡—ãƒ©ãƒ³ã‚­ãƒ³ã‚°2021(é¦–éƒ½åœ)",
                                    displayMode: .inline)
            }
        }
    }
}
```

`ContentPageView` ã« `TownRankingData` å‹ã§å®šæ•°ã‚’å®£è¨€ã—ã¦å€¤æ¸¡ã—ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
ä»Šå›ã¯ï¼Œå­Viewã§ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›´ã¯è¡Œã‚ãªã„ã®ã§ãŸã ã®å€¤æ¸¡ã—ã§ã™ã€‚
ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆã® `TownRankingListView` ã«ã‚‚å€¤æ¸¡ã—ã—ã¾ã™ã€‚
ä»Šå›ã¯ï¼Œå€Ÿã‚Šã¦ä½ã¿ãŸã„ï¼Œè²·ã£ã¦ä½ã¿ãŸã„ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã®ãƒ¢ãƒ‡ãƒ«ã‚’ãã‚Œãã‚Œæ¸¡ã—ã¾ã™ã€‚

```diff swift:
struct ContentPageView: View {
    // ãƒšãƒ¼ã‚¸ãƒ³ã‚°ã™ã‚‹ã“ã¨ã§çŠ¶æ…‹ãŒå¤‰ã‚ã‚‹ã®ã§ @Binding ã‚’ä½¿ã†
    @Binding var selection: TabType
    // å­Viewã§ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›´ã¯è¡Œã‚ãªã„ã®ã§å€¤æ¸¡ã—ã§è‰¯ã„
+   let townRankingData: TownRankingData
    let safeAreaBottomHeight: CGFloat

    var body: some View {
        TabView(selection: $selection) {
            TownRankingListView(selection: selection,
+                               townInfo: townRankingData.townRankingsForRent,
                                safeAreaBottomHeight: safeAreaBottomHeight)
                .tag(TabType.rent)
            TownRankingListView(selection: selection,
+                               townInfo: townRankingData.townRankingsForBuy,
                                safeAreaBottomHeight: safeAreaBottomHeight)
                .tag(TabType.buy)
        }
        .tabViewStyle(PageTabViewStyle(indexDisplayMode: .never))
        .animation(.linear(duration: 0.3))
    }
}
```

ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒªã‚¹ãƒˆã® `TownRankingListView` ã§å®£è¨€ã™ã‚‹ã®ã¯ï¼Œ
`[TownInfo]` å‹ã®å®šæ•°ã§ã™ã€‚ä»Šå›ã¯ 20è¦ç´ åˆ†ã‚ã‚‹ã®ã§ `miné–¢æ•°` ã‚’ä½¿ã£ã¦ï¼Œ
1ã€œ10ä½ï¼Œ11ã€œ20ä½ã®ç¯„å›²ã®è¦ç´ ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã« `ForEach` ã®ç¯„å›²ã‚’èª¿æ•´ã—ã¦ã„ã¾ã™ã€‚
é™çš„ãªãƒ‡ãƒ¼ã‚¿ã‚’ã‚»ãƒ« View ã«æ¸¡ã—ã¦ã„ãŸã¨ã“ã‚ã‚’å„è¡—ãƒ‡ãƒ¼ã‚¿(`TownInfo`)ã«å¤‰æ›´ã—ã¦ã„ã¾ã™ã€‚
`index` ä½¿ã‚ãªã„ã®ã«æ›¸ã„ã¦ãŸã®ã¯ã“ã®ãŸã‚ã§ã—ãŸã€‚
æœ€ä¸‹éƒ¨ã®ãƒœã‚¿ãƒ³ã¯ï¼Œãƒ‡ãƒ¼ã‚¿å–å¾—å¾Œã«è¡¨ç¤ºã•ã›ã‚‹ãŸã‚ã«æ¡ä»¶æ–‡ã‚’è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚

```diff swift:
struct TownRankingListView: View {

    let selection: TabType
+   let townInfo: [TownInfo]
    let safeAreaBottomHeight: CGFloat
    @State private var isExpanded = false

    var body: some View {
        ScrollView {
            LazyVGrid(columns: [GridItem()], spacing: 0.0) {
                Section {
-                   ForEach(0 ..< 10) { index in
-                       TownRowView(selection: selection, rank: 1, isRankUp: true, rankFluctuation: 10)
-                           .padding(.bottom, 10.0)
-                   }
+                   ForEach(0 ..< min(townInfo.count, 10)) { index in
+                       TownRowView(selection: selection,
+                                   townInfo: townInfo[index])
+                           .padding(.bottom, 10.0)
+                   }
                }
                if isExpanded {
                    Section {
-                       ForEach(0 ..< 10) { index in
-                           SubTownRowView(selection: selection, rank: 11, isRankUp: true, rankFluctuation: 30)
-                           Divider()
-                       }
+                       ForEach(min(townInfo.count, 10) ..< townInfo.count) { index in
+                           SubTownRowView(selection: selection,
+                                          townInfo: townInfo[index])
+                           Divider()
+                       }
                    }
                }
            }
            .padding(.all, 16.0)
            // ãƒ‡ãƒ¼ã‚¿å–å¾—å‰ã¯è¡¨ç¤ºã•ã›ãªã„
+           if !townInfo.isEmpty {
                ExpandButtonView(selection: selection, isExpanded: $isExpanded)
                    .padding(.horizontal, 16.0)
                    .padding(.bottom, 16.0 + safeAreaBottomHeight)
+           }
        }
        .background(Color.gridBackground)
    }
}
```

æœ€å¾Œã«ã‚»ãƒ«ã®Viewã®ãƒ‡ãƒ¼ã‚¿ã®å€¤æ¸¡ã—ã§ã™ã€‚
`let townInfo: TownInfo` ã‚’å®šç¾©ã—ã¦å€¤ã‚’å—ã‘ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
`TownInfo` ã«è¡—ãƒ»ãƒ©ãƒ³ã‚¯æƒ…å ±ãŒå…¥ã£ã¦ãã‚‹ã®ã§ãã®ãƒ‡ãƒ¼ã‚¿ã‚’å‚ç…§ã™ã‚‹ã‚ˆã†ã«æ›¸ãæ›ãˆã¾ã™ã€‚
ã“ã“ã§ã¯çœç•¥ã—ã¾ã™ã€‚

å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚

**ã“ã‚Œã§çµ‚ã‚ã‚Šã ã¨æ€ã£ãŸãƒ»ãƒ»ãƒ»**

å€Ÿã‚Šã¦ä½ã¿ãŸã„å´ã® 1ã€œ10ä½ã®è¡¨ç¤ºãŒå‡ºã¾ã›ã‚“ã€‚ã‚€ã‚€ã‚€ğŸ¤”
ãƒœã‚¿ãƒ³ã¯è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã—ï¼Œ11ã€œ20ä½ã®ãƒ‡ãƒ¼ã‚¿ã‚‚ã‚ã‚‹ã®ã§å…¨éƒ¨å–ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚

GIF

æ¤œç´¢ã—ã¦ã¿ãŸã¨ã“ã‚ï¼Œä¸‹è¨˜è¨˜äº‹ã«ã‚‚åŒæ§˜ã®å†…å®¹ã®è¨˜è¼‰ãŒã‚ã‚Šã¾ã—ãŸã€‚
https://hack.nikkei.com/blog/advent20201201/

> TabViewã®ContentViewã‚’é™çš„ãªå›ºå®šå€¤ã§ã¯ãªãã€APIã‹ã‚‰å‹•çš„ã«å–å¾—ã™ã‚‹å ´åˆã€å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒæ­£å¸¸ã«åƒã‹ãªã„æŒ™å‹•ã‚’ç¢ºèªã—ã¦ã„ã¾ã™ã€‚ TabViewã«idãƒ¡ã‚½ãƒƒãƒ‰ã‚’é©ç”¨ã—ã¦ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«å¤‰åŒ–ãŒèµ·ããŸã‚‰å¼·åˆ¶çš„ã«å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’è¡Œã‚ã›ã‚‹ã“ã¨ã§å¯¾å¿œã§ãã¾ã™ã€‚

iOS 15 ã§è§£æ¶ˆã•ã‚Œã‚Œã°ã„ã„ãªãã€‚
ã¨ã„ã†ã“ã¨ã§åŒæ§˜ã®å‡¦ç†ã‚’ã—ã¦ã¿ã¾ã—ãŸã€‚

ã¾ãšã¯ãƒ¢ãƒ‡ãƒ«ã®æ§‹é€ ä½“ã‚’ `Hashable` ã«æº–æ‹ ã•ã›ã¾ã™ã€‚

```swift:TownInfo.swift
// Hashable ã«æº–æ‹ ã•ã›ã‚‹
struct TownInfo: Decodable, Hashable {
    var rank: Int
    var townName: String
    var isRankUp: Bool
    var rankFluctuation: Int
    var availableLine: String
}
```

æ¬¡ã« `TabView` ã« `id` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’é©ç”¨ã•ã›ã¾ã™ã€‚

```diff swift:ContentPageView.swift
struct ContentPageView: View {

    @Binding var selection: TabType
    let townRankingData: TownRankingData
    let safeAreaBottomHeight: CGFloat

    var body: some View {
        TabView(selection: $selection) {
            TownRankingListView(selection: selection,
                                townInfo: townRankingData.townRankingsForRent,
                                safeAreaBottomHeight: safeAreaBottomHeight)
                .tag(TabType.rent)
            TownRankingListView(selection: selection,
                                townInfo: townRankingData.townRankingsForBuy,
                                safeAreaBottomHeight: safeAreaBottomHeight)
                .tag(TabType.buy)
        }
        .tabViewStyle(PageTabViewStyle(indexDisplayMode: .never))
        .animation(.linear(duration: 0.3))
+       // APIã§å–å¾—ã—ã¦ã‚‚ç”»é¢æ›´æ–°ã•ã‚Œãªã„ãŸã‚
+       .id(townRankingData.townRankingsForRent.hashValue)
    }
}
```

ä¸Šè¨˜ä¿®æ­£ã‚’è¿½åŠ ã—ãŸã‚‰ã¡ã‚ƒã‚“ã¨ 1ã€œ10ä½ã‚‚è¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚

GIF

## ãŠã‚ã‚Šã«

ä»Šå›ã¯ï¼ŒUIã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ä½¿ã£ã¦ã¿ãŸã„æ–°è¦ç´ ã ã‘ã‚’æŒã£ã¦å®Ÿè£…é€²ã‚ã¾ã—ãŸãŒï¼Œ
æ„å¤–ã¨ä½œã‚Œã‚‹ã‚‚ã®ã ãªããŒ7å‰²ï¼Œã“ã‚Œã©ã†å®Ÿè£…ã™ã‚‹ã‚“ã ï¼Ÿ3å‰²ãã‚‰ã„ã§æ¥½ã—ã‹ã£ãŸã§ã™ã€‚
å¹…åºƒãå¾©ç¿’ã§ããŸã®ã§ã¾ãã¾ãæº€è¶³ã—ã¦ã¾ã™ã€‚

SwiftUI ã¯æ¥­å‹™ã§ã¾ã ã•ã‚ã‚Œãªã„åˆ†ï¼Œå€‹äººé–‹ç™ºã§ï¼ã¨ã„ã†æ„Ÿã˜ã§ä»˜ãåˆã£ã¦ã„ã¾ã™ã€‚
ä»Šä½œã£ã¦ã‚‹æ–°è¦ã‚¢ãƒ—ãƒªã¯ï¼ŒUIKit ã§ã¾ãšç”»é¢å˜ä½ã§ä½œã£ã¦ SwiftUI ã§ä½œã‚Œãã†ãªã‚‰
`UIHostingController` ã‚’åˆ©ç”¨ã—ã¦æ¡ç”¨ã¨ã„ã†å½¢ã§ã‚„ã£ã¦ã„ã¾ã™ã€‚
`ContainerView` ãªã©ã§éƒ¨åˆ†çš„ã«ä½œã‚Œã‚‹å ´åˆã‚‚è€ƒæ…®ã¯ã—ã¦ã„ã¾ã™ã€‚

UIKit ã˜ã‚ƒãªãã¦ã‚‚å®Ÿç¾ã§ãã‚‹ã“ã¨ãŒå¢—ãˆã¦ããŸã®ã§ï¼Œ
æ™®æ®µã‹ã‚‰è§¦ã£ã¦ãŠãã®ãŒè‰¯ã„ãªã¨æ€ã„ã¾ã—ãŸã€‚
ãŸã ï¼ŒiOS 14 (SwiftUI 2)ä»¥ä¸Šã§ã‚„ã£ã¨ä½¿ãˆã‚‹ãƒ¬ãƒ™ãƒ«ã ã¨æ€ã£ã¦ã‚‹ã®ã§
ã‚¹ãƒˆãƒ¬ã‚¹ãªãé–‹ç™ºã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¾ã§æ­£ç›´æˆ‘æ…¢ã§ã™ã­ã€‚

ã”è¦§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚

## å‚è€ƒ

[^1]:https://developer.apple.com/documentation/swiftui/withanimation(_:_:)
[^2]:https://developer.apple.com/documentation/swiftui/view/animation(_:)
[^3]:https://developer.apple.com/documentation/swiftui/lazyvgrid
